\documentclass[a4paper,10pt]{article}
\usepackage{amsmath}
\usepackage[usenames]{color}

\newcommand{\MeOH}{\ensuremath{\mathrm{CH_3OH}}}
\newcommand{\HHO}{\ensuremath{\mathrm{H_2O}}}
\newcommand{\OO}{\ensuremath{\mathrm{O_2}}}
\newcommand{\NN}{\ensuremath{\mathrm{N_2}}}
\newcommand{\COO}{\ensuremath{\mathrm{CO_2}}}

\newcommand{\Parameter}[1]{\textcolor{green}{#1}}
\newcommand{\Measurement}[1]{\textcolor{red}{#1}}
\newcommand{\Estimate}[1]{\textcolor{blue}{#1}}

\newcommand{\DER}[2]{\ensuremath{\frac{\mathrm{d}\,#1}{\mathrm{d}\,#2}}}

%opening
\title{Continuous Control in DMFC Systems}
\author{Federico Zenith}

\begin{document}

\maketitle

\section{Overall Problem Description}

\subsection{Control Task}
To maintain appropriate reactant concentrations and system temperature, so that
the reaction may proceed; to recover water in order to maintain the water
content in the anode loop.

\subsection{Disturbances}
The main disturbances are the reaction, which results in:
\begin{itemize}
\item consumption of methanol at the anode;
\item production of water at the cathode;
\item water cross-over from anode to cathode;
\item temperature increase.
\end{itemize}

In addition, the methanol cross-over depends on the methanol concentration on
the anode, and produces some \COO\ at the cathode; otherwise, it is similar to
reaction.

The current (and thereby the reaction rate) is easily measured, whereas the
methanol crossover can be estimated given the methanol concentration.

\subsection{Manipulated Variables}
\begin{itemize}
\item The air flow through the cathode;
\item The solution flow through the anode;
\item The methanol fuel-feed flow into the solution mixer;
\item The cooling of cathode outflow (condenser);
\item The cooling of anode outflow (cooler).
\end{itemize}

\subsection{Measurements}
Temperature measurements are cheap and easy; some interesting ones could be in
the fuel cell itself, the condenser, the anode-loop cooler, and the environment.

Flow in anode and cathode may be set feedforward, assuming that pumps and
blowers can set their instructed flow rates reliably enough by themselves.

Concentration measurements are expensive, slow and we would rather avoid them.
The concentration of methanol is however stable: more methanol means more
crossover in the cell (and also more loss in the \COO\ separator, though that
should be of lesser importance). Since the main disturbance, the current, is
measurable, feedforward should be an option.

Water content in the anode loop is however not stable: we need some measure of
the loop level to implement a feedback control loop.

\subsection{Constraints}
The main constraint is the ability of condensing water vapour from the cathode.
To maintain a high oxygen concentration we would like maximum air flow, but this
will cause the water vapour to thin out; it will therefore be necessary to cool
down the flow to a much lower temperature than otherwise, straining the
condenser duty. Since we have a limit on minimum condenser temperature (the
environment temperature), there is an envelope of conditions for which water
recovery is unfeasible.

It is therefore necessary that the controller determining air flow considers
both water recovery and oxygen concentration (at least a MISO, then).

\subsection{Possible Strategies}
The air flow should be set primarily to maintain oxygen concentration, and
whenever possible to recover water vapour. The first part may be a feedforward
controller based on measurement of current (which is easy and cheap to sample
with high bandwidth), and the other on a measurement of water quantity in the
anodic loop; feedback is probably necessary, though it must be checked whether
the quantity of water in the anodic loop is stable or not, and with which
dynamics.

The cooling of the cathode outflow should be related to the actual requirement
of liquid water. It will be advantageous to provide to this controller
information about the operation status of the air flow controller.

The methanol concentration can be controlled using the fuel feed by means of
feedforward control. The dynamics of methanol concentration should be stable,
since there are two stabilising terms:
\begin{itemize}
\item more methanol means more crossover;
\item more methanol means more methanol loss in the \COO\ separation stage.
\end{itemize}
It remains to be seen whether these two factors are enough to provide a decent
dynamic performance.

Anodic flow should be set so that it provides reactant to the fuel cell
proportionally to the current; a feedforward is probably appropriate.

Temperature can be influenced in a variety of ways. Obviously the cooler on the
anodic loop is a good tool to reduce the temperature. However, if temperature
must be raised, fuel feed may be used to increase concentration and thereby
methanol crossover.

\pagebreak
\section{Tentative Control System}
These are some ideas for the simplest set of controllers. Avoid any excessive
optimisations here, and \emph{keep it simple}.

\subsection{Disturbance Specification}
The only significant disturbance for now is current. A DMFC stack will be
connected to a user through a battery, which will handle the fast transients.

We can model a random disturbance by passing a random signal through a low-pass
filter with a time constant in the same order of magnitude of the time the
buffer battery can function on its own, say 10 minutes. Alternatively, we can
use a standard cycle and pass it through the low-pass filter.

Parameters such as environment temperature and humidity are unlikely to change
over a simulation (much larger bandwidth), so if anything the algorithm should
adapt to these parameters but not to track their variations.

\subsection{Oxygen}
Use feedforward, with $\lambda$ control. Typically $\lambda=2$, and will be a
parameter. Will need an estimate on the crossover to compensate for it.

\begin{equation}
\dot n_\text{air} = \frac{\Parameter{\lambda}}{x_\OO^\text{env}} \,
\frac{\Measurement{I}+\Estimate{I_c}}{4\,F}
\end{equation}


\subsection{Temperature}
Feedback is cheap (thermocouple). A P or PI controller may be enough. For
cooling manipulate the loop cooler, for heating use cascade with inlet
methanol concentration.

\begin{equation}
u = K_c \left[ (T^\text{ref}-T) +
\frac{1}{\tau_I}\int_0^t (T^\text{ref}-T) \,\mathrm{d}\,t \right]
\end{equation}

If $u>0$, methanol concentration will be increased; if $u<0$, loop cooling will
be used instead.

\subsection{Methanol Outlet Concentration}
Outlet concentration should be set so that an increase in current cannot deplete
the methanol concentration. The outlet level must therefore be set according to
the specific dynamics of the disturbance (the current) and of the system itself,
i.e. how much time an increased concentration from the mixer needs to reach the
cell.

Note that increasing the loop flow rate will:
\begin{itemize}
\item almost immediately increase the outlet concentration, even if the inlet
one still has to change;
\item reduce the time necessary for the increased mixer concentration to
propagate to the inlet.
\end{itemize}
It seems therefore reasonable to control the outlet concentration with the loop
flow rate.

\subsection{Methanol Inlet Concentration}
The inlet concentration, instead, will be set by the fuel flow, which is the
remaining manipulable variable.

We do not want a concentration measurement (expensive, cumbersome and slow), so
we are going to use feedforward. This assumes the system dynamics is stable and
its disturbances are either measurable ($I$) or estimable with a certain
confidence ($I_c$).

The inlet concentration is, in our model, equal to the mixer concentration
(transients are assumed not to occur between mixer and cell):
\begin{equation}
c^\text{in} = c^\text{mixer} = \frac{n_\MeOH}{V}
\end{equation}

We also assume that solution volume $V$ is kept constant by another loop or at
least changes very slowly:

\begin{equation}
\begin{aligned}
\DER{n_\MeOH}{t} & = \dot n_\text{fuel} - \frac{I}{6\,F}
- \frac{I_c(i,c,T)}{6\,F}\\
& = u - \alpha\,I - \beta\,c
\end{aligned}
\end{equation}

The system is stable as long as $\beta>0$, which is the case for any value of
crossover. Once the parameters $\alpha$ and $\beta$ are estimated (both could
in theory vary with temperature), it would be elementary to state the
feedforward control law:
\begin{equation}
n_\text{fuel} = \alpha\,\Measurement{I} + \beta\,\Estimate{c}
\end{equation}

However, while we do have a measurement on $I$, we need to estimate $c$. Since
the system is stable, we will use $\Estimate{c} = c^\text{ref}$.

When the reference is changed, and supposing that the solution volume is known,
it could be possible to add or remove the correct quantity of methanol rapidly
by setting an additional feedforward term:
\begin{equation}
n_\text{fuel} = \alpha\,\Measurement{I} + \beta\,c^\text{ref} +
\DER{c^\text{ref}}{t}\,V_\text{sol}
\end{equation}

It is likely that in case of steps the saturation limit for the input will be
reached; in such cases an integrator of some sort may keep memory of this, in
order to maintain the flow at maximum or minimum for as long as necessary. (this
part needs formalisation.)

The derivative on $c^\text{ref}$ can be realised with a realisable derivative
element obtained by cutting off at a certain frequency, using an appropriate
approximating transfer function.



\pagebreak
\section{Operational Envelope for Water Recovery}
Air entering the cathode is assumed to be at environmental temperature
$T_\text{env}$ and humidity $RH_\text{env}$. Its water fraction is therefore
determined as:
\begin{equation}
x_\HHO^0 = RH_\text{env}\,\frac{p_\HHO^0(T_\text{env})}{p_\text{env}}
\end{equation}

In the fuel cell's cathode, water will be produced and transported, because of:
\begin{itemize}
\item reaction of oxygen with hydrogen ions;
\item water drag;
\item methanol crossover and immediate reaction.
\end{itemize}

The first two terms are roughly proportional with current, whereas the last is
proportional with methanol concentration on the anode side's catalyst layer,
which is lower at high currents because of diffusion.

The produced water will be:
\begin{equation}
\frac{\dot n_\HHO}{A} = \left( \overbrace{2}^\text{drag} +
\overbrace{\frac{3}{6}}^\text{reaction} \right) \frac{i}{F} +
2\,\overbrace{\frac{D_M}{d_M}\,c_{ac}}^\text{crossover}
\end{equation}

Assuming that the catalyst-layer methanol concentration depends on current and
bulk methanol concentration as:
\begin{equation}
k_a(c_a-c_{ac}) = \underbrace{
\overbrace{\frac{D_M}{d_M}\,c_{ac}}^\text{crossover} +
\overbrace{\frac{i}{6\,F}}^\text{reaction}
}_\text{total consumption}
\end{equation}
We can express $c_{ac}$ as:
\begin{equation}
c_{ac} = \frac{k_a\,c_a - \frac{i}{6\,F}}{k_a+\frac{D_M}{d_M}}
= \alpha \, c_a - \beta \,i
\end{equation}
where we used $\alpha \in [0,1]$ and $\beta>0$ to illustrate that catalyst-layer
concentration depends essentially on current and bulk concentration.
The expression for water production is then:

\begin{equation}
\boxed{
\frac{\dot n_\HHO}{A} = \overbrace{\left(15 - \frac{2\,\frac{D_M}{d_M}}{k_a+
\frac{D_M}{d_M}}\right)}^{\in~(13,15)} \frac{i}{6\,F} +
2\,\overbrace{\frac{k_a\,\frac{D_M}{d_M}}{k_a+\frac{D_M}{d_M}}}^{i_c^0} \, c_a
}
\end{equation}
where $i_c^0$ is the ``baseline'' methanol crossover current density, which
occurs at zero current.

The two terms that influence water production are current density and
methanol concentration in the anode bulk. Note, though, that $D_M$ and $k_a$ may
display some dependence on temperature.

The water lost in the anode is:
\begin{equation}
\frac{\dot n_\HHO}{A} = \left( \overbrace{2}^\text{drag} +
\overbrace{\frac{1}{6}}^\text{reaction} \right) \frac{i}{F}=
\frac{13}{6}\frac{i}{F} = 2.166 \frac{i}{F}
\end{equation}

Whereas the water lost in the anode-loop \COO\ separator is (assuming no
methanol present, as a conservative estimate):
\begin{equation}
\dot n_\HHO = \frac{x_\HHO(T)}{1-x_\HHO(T)}\,\frac{i}{6\,F}
\end{equation}

Where $x_\HHO$ is the equilibrium vapour fraction in air at the temperature
of the \COO\ separator.

Typical values of the term multiplying $\frac{i}{F}$ are:
\begin{equation}
\frac{x_\HHO(T)}{6\,[1-x_\HHO(T)]} =
\begin{cases}
0.023 & T = 323\,\mathrm{K}\\
0.035 & T = 330\,\mathrm{K}\\
0.062 & T = 340\,\mathrm{K}\\
0.117 & T = 350\,\mathrm{K}
\end{cases}
\end{equation}

It appears that the water loss in the \COO\ separator is, in all cases of
interest, one order of magnitude smaller than the loss in the reaction and
drag terms.

The exiting air will be volumetrically larger (it will have much more water
vapour to offset the lost oxygen), and at stack temperature. What is necessary
is to find out how much water can be condensed by bringing the air flow down to
environment temperature.

It is possible to connect the entering air flow by assuming that it is operated
according to a stoichiometric-ratio specification:

\begin{equation}
\dot n_\text{air} = \frac{\lambda}{x_\OO^0}\, \frac{I}{4\,F}
\end{equation}

After the reaction,
\begin{itemize}
\item nitrogen flow will be the same, $\lambda \, \frac{x_\NN^0}{x_\OO^0}\,
\frac{i}{4\,F}$;
\item oxygen flow will be reduced by 1 in $\lambda$-scale because of the
reaction, and by an amount corresponding to 3/2 of the methanol
crossover:
\begin{equation}
\begin{aligned}
\frac{\dot n_\OO}{A} &= \overbrace{\lambda\frac{i}{4\,F}}^\text{Entering oxygen}
- \overbrace{\frac{i}{4\,F}}^\text{Cathodic reaction}
- \overbrace{ \frac{3}{2}\,\frac{D_M}{d_M}\,c_{ac}}^\text{Methanol crossover}\\
&= (\lambda - 1) \frac{i}{4\,F} - \frac{3}{2}\,\frac{k_a\,\frac{D_M}{d_M}}
{k_a+\frac{D_M}{d_M}}\,c_a
\end{aligned}
\end{equation}
\item we can assume that there is no carbon dioxide entering, or at least very
little compared to what is generated by the methanol crossover (there are only
small amounts in the atmosphere):
\begin{equation}
\frac{\dot n_\COO}{A} = \frac{k_a\,\frac{D_M}{d_M}} {k_a+\frac{D_M}{d_M}}\,c_a
\end{equation}
\item water flow will depend on water and methanol crossover, reaction, and
naturally on the entering air:
\begin{equation}
\begin{aligned}
\frac{\dot n_\HHO}{A} & = \overbrace{\lambda \, \frac{x_\HHO^0}{x_\OO^0} \,
\frac{i}{4\,F}}^\text{Entering vapour} +
\overbrace{2\,\frac{i}{F}}^\text{Water drag} +
\overbrace{\frac{3}{6}\frac{i}{F}}^\text{Cathodic reaction}
+ \overbrace{2\,\frac{D_M}{d_M}\,c_{ac}}^\text{Methanol crossover}\\
& = \left( 1.5\,\lambda \frac{x_\HHO^0}{x_\OO^0} + 15
- \frac{2\,\frac{D_M}{d_M}}{k_a+\frac{D_M}{d_M}} \right)\frac{i}{6\,F}
+ 2\,\frac{k_a\,\frac{D_M}{d_M}}{k_a+\frac{D_M}{d_M}}\, c_a
\end{aligned}
\end{equation}

From this, it is possible to find out the water fraction, and how much the
flow has to be cooled in order to condensate a certain amount of water.

\end{itemize}





\end{document}
